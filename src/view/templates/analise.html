{% extends "base.html" %}

{% block content %}
{{ super() }}
<!-- ANÃLISE -->
<div id="analise" class="screen">
    <div class="filters">
        <select>
            <option value="all">Todos os Clusters</option>
            <option value="elite">Elite</option>
            <option value="competitive">Competitivo</option>
            <option value="intermediate">Intermediario</option>
            <option value="intermediate">Iniciante</option>
        </select>
        <select>
            <option value="all">Todas as Idades</option>
            <option value="'10-18'">10-18 anos</option>
            <option value="'19-29'">19-29 anos</option>
            <option value="'30+'">30+ anos</option>
        </select>
    </div>

    <div class="table-container">
        <div class="table-header">
            <div>#</div>
            <div>Nome</div>
            <div>Altura (cm)</div>
            <div>Envergadura (cm)</div>
            <div>Arremesso (cm)</div>
            <div>Salto (cm)</div>
            <div>Abdom (rep/min)</div>
            <div>Score (pontos/100)</div>
            <div>Cluster</div>
        </div>

        {% if athletes['items'] == [] %}
        <div class="table-row">
            <div class="name">
                Nenhum Atleta
            </div>
        </div>
        {% else %}
        {% for athlete in athletes['items'] %}
        <div class="table-row">
            <div class="rank">1</div>
            <div class="name">
                {{ athlete.nome }}
                <div class="sub">{{ athlete.idade }} anos, {{ athlete.sexo }}</div>
            </div>
            
            <div class="metric">{{ athlete.altura }}</div>
            <div class="metric">{{ athlete.envergadura }}</div>
            <div class="metric">{{ athlete.arremesso }}</div>
            <div class="metric">{{ athlete.saltoHorizontal }}</div>
            <div class="metric">{{ athlete.abdominais }}</div>
            <div><span class="badge badge-{{ athlete.cluster.lower() }}">{{ athlete.cluster }}</span></div>
        </div>
        {% endfor %}
        {% endif %}
    </div>

    <div class="actions">
        <button class="btn btn-secondary" onclick="exportPDF()">Exportar PDF</button>
        <button class="btn btn-secondary" onclick="exportExcel()">Exportar Excel</button>
    </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
function exportPDF() {
    const data = {
        athletes: {{ athletes | tojson | safe }},
        filters: {
            query: {{ request.args.get('query') | tojson | safe }},
            sort: {{ request.args.get('sort') | tojson | safe }},
            sortOrder: {{ request.args.get('sortOrder') | tojson | safe }}
        }
    };

    const pdf = document.getElementById('pdf');
    pdf.src = `/static/pdf/analise.pdf?${new URLSearchParams(data).toString()}`;
}

function exportExcel() {
    const data = {
        athletes: {{ athletes | tojson | safe }},
        filters: {
            query: {{ request.args.get('query') | tojson | safe }},
            sort: {{ request.args.get('sort') | tojson | safe }},
            sortOrder: {{ request.args.get('sortOrder') | tojson | safe }}
        }
    };

    const blob = new Blob([JSON.stringify(data)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);

    const link = document.createElement('a');
    link.href = url;
    link.download = 'analise.json';
    link.click();
}

document.addEventListener('DOMContentLoaded', function() {
  const navItem = document.querySelector('.review-nav');
  const activeNavItem = document.querySelector('.nav-btn.active');
  
  if (navItem) {
    navItem.classList.add('active');
  }
  
  if (activeNavItem) {
    activeNavItem.classList.remove('active');
  }
});
    
</script>
{% endblock %}