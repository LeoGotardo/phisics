{% extends "base.html" %}

{% block content %}
{% super() %}
<!-- ANÃLISE -->
<div id="analise" class="screen">
    <div class="filters">
        <select>
            <option value="all">Todos os Clusters</option>
            <option value="elite">Elite</option>
            <option value="competitive">Competitivo</option>
            <option value="intermediate">Intermediario</option>
            <option value="intermediate">Iniciante</option>
        </select>
        <select>
            <option value="all">Todas as Idades</option>
            <option value="'10-18'">10-18 anos</option>
            <option value="'19-29'">19-29 anos</option>
            <option value="'30+'">30+ anos</option>
        </select>
    </div>

    <div class="table-container">
        <div class="table-header">
            <div>#</div>
            <div>Nome</div>
            <div>Altura</div>
            <div>Envergadura</div>
            <div>Arremesso</div>
            <div>Salto</div>
            <div>Abdom</div>
            <div>Score</div>
            <div>Cluster</div>
        </div>

        {% for athlete in athletes %}
        <div class="table-row">
            <div class="rank">1</div>
            <div class="name">
                {{ athlete.nome }}
                <div class="sub">{{ athlete.data_nascimento.year }} anos, {{ athlete.sexo }}</div>
            </div>
            
            <div class="metric">{{ athlete.estatura }}</div>
            <div class="metric">{{ athlete.envergadura }}</div>
            <div class="metric">{{ athlete.arremesso }}</div>
            <div class="metric">{{ athlete.salto_horizontal }}</div>
            <div class="metric">{{ athlete.abdominais }}</div>
            <div><span class="badge badge-{{ athlete.nivel_desempenho.lower() }}">{{ athlete.nivel_desempenho }}</span></div>
        </div>
        {% endfor %}
    </div>

    <div class="actions">
        <button class="btn btn-secondary" onclick="exportPDF()">Exportar PDF</button>
        <button class="btn btn-secondary" onclick="exportExcel()">Exportar Excel</button>
    </div>
</div>
{% endblock %}

{% block scripts %}
{% super() %}
<script>
    function exportPDF() {
        const data = {
            athletes: {{ athletes | tojson | safe }},
            filters: {
                query: {{ request.args.get('query') | tojson | safe }},
                sort: {{ request.args.get('sort') | tojson | safe }},
                sortOrder: {{ request.args.get('sortOrder') | tojson | safe }}
            }
        };

        const pdf = document.getElementById('pdf');
        pdf.src = `/static/pdf/analise.pdf?${new URLSearchParams(data).toString()}`;
    }

    function exportExcel() {
        const data = {
            athletes: {{ athletes | tojson | safe }},
            filters: {
                query: {{ request.args.get('query') | tojson | safe }},
                sort: {{ request.args.get('sort') | tojson | safe }},
                sortOrder: {{ request.args.get('sortOrder') | tojson | safe }}
            }
        };

        const blob = new Blob([JSON.stringify(data)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);

        const link = document.createElement('a');
        link.href = url;
        link.download = 'analise.json';
        link.click();
    }
    
</script>
{% endblock %}